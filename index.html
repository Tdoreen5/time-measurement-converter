<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="stylesheet" href="styles.css" />
    <title>Time Measurement Converter</title>
  </head>
  <body>
    <div class="container">
      <h1>Time Measurement Converter</h1>
      <p>Convert time between hours, minutes, and seconds:</p>

      <div class="form-group">
        <label for="timeValue">Enter Time Value:</label>
        <input type="number" id="timeValue" placeholder="Enter a number" />
      </div>

      <div class="form-group">
        <label for="fromUnit">From:</label>
        <select id="fromUnit">
          <option value="hours">Hours</option>
          <option value="minutes">Minutes</option>
          <option value="seconds">Seconds</option>
        </select>
      </div>

      <div class="form-group">
        <label for="toUnit">To:</label>
        <select id="toUnit">
          <option value="hours">Hours</option>
          <option value="minutes">Minutes</option>
          <option value="seconds">Seconds</option>
        </select>
      </div>

      <button onclick="convertTime()">Convert</button>

      <h2>Result:</h2>
      <p id="result">---</p>

      <button onclick="downloadResult()" id="downloadBtn" style="display:none;">Download Result</button>
    </div>

    <script>
      // Conversion function
      function convertTime() {
        const timeValue = parseFloat(document.getElementById("timeValue").value);
        const fromUnit = document.getElementById("fromUnit").value;
        const toUnit = document.getElementById("toUnit").value;
        let result;

        if (isNaN(timeValue)) {
          result = "Please enter a valid number.";
        } else {
          const conversionRates = {
            hours: { minutes: 60, seconds: 3600 },
            minutes: { hours: 1 / 60, seconds: 60 },
            seconds: { hours: 1 / 3600, minutes: 1 / 60 },
          };

          if (fromUnit === toUnit) {
            result = `${timeValue} ${toUnit}`;
          } else {
            result = timeValue * conversionRates[fromUnit][toUnit];
            result = `${result} ${toUnit}`;
          }
        }

        document.getElementById("result").textContent = result;
        
        // Show download button
        document.getElementById("downloadBtn").style.display = "block";
      }

      // Download result as a text file
      function downloadResult() {
        const resultText = document.getElementById("result").textContent;
        const blob = new Blob([resultText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "conversion_result.txt";
        a.click();
        URL.revokeObjectURL(url);
      }

      // Register service worker for push notifications
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/service-worker.js")
          .then((registration) => {
            console.log("Service Worker registered with scope:", registration.scope);

            // Request push notification permission
            if ("Notification" in window && navigator.serviceWorker) {
              Notification.requestPermission().then((permission) => {
                if (permission === "granted") {
                  subscribeUserToPush(registration);
                }
              });
            }
          })
          .catch((error) => {
            console.error("Service Worker registration failed:", error);
          });
      }

      // Subscribe user to push notifications
      function subscribeUserToPush(registration) {
        registration.pushManager
          .subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlB64ToUint8Array("<your_public_vapid_key>"), // Replace with your VAPID public key
          })
          .then((subscription) => {
            console.log("User is subscribed:", subscription);
            // Here you could send the subscription object to your server to store it
          })
          .catch((err) => {
            console.error("Failed to subscribe the user:", err);
          });
      }

      // Helper function to convert VAPID key
      function urlB64ToUint8Array(base64String) {
        const padding = "=".repeat((4 - base64String.length % 4) % 4);
        const base64 = (base64String + padding).replace(/\-/g, "+").replace(/_/g, "/");
        const rawData = window.atob(base64);
        const outputArray = new Uint8Array(rawData.length);
        for (let i = 0; i < rawData.length; ++i) {
          outputArray[i] = rawData.charCodeAt(i);
        }
        return outputArray;
      }

    </script>
  </body>
</html>
